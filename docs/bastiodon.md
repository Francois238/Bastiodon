
# Bastiodon

Launch attack and wait for an alert from QRadar corresponding to this alert

## Plugin Creation

To create the plugin, use this repo: https://github.com/mitre/skeleton
It's a plugin skeleton that also (slightly) contains the documentation for developing the plugin. 

## Installation

### The current version of Caldera is 4.2.0. Version 5 introduces a major redesign of the front end with framework changes that make the current plugin incompatible.

The bastiodon folder is located in the plugins folder on the Caldera server.  
To activate the Bastiodon plugin on Caldera, add `bastiodon` to the list of plugins in the local.yml file in the conf/ folder.  

Example:  

```
plugins:
- bastiodon
- atomic
- compass
- debrief
```

To work, the plugin needs the following environment variables:  
`qradar_ip` and `qradar_token`.  
  

`qradar_ip` corresponds to the url of the Qradar server.  
Example: `qradar_ip=https://10.10.10.240`.  
  

`qradar_token` corresponds to the token generated by the Qradar adminstrator to authorize the Bastiodon plugin to make API calls to Qradar.  
Example: `qradar_token=aaaaa-aaa-aaa-aaa-aaa`

The account service needs access to the following endpoints:
- GET `/api/siem/offenses`
- GET `/api/analytics/rules`
  
## Plugin access from Caldera WebUI

The plugin is accessible to the blue user (a plugin must be configured to be used by the red or blue user).  

The plugin is available in the blue user's plugin list:
![Home blue team](./img/pluginList.png)

The plugin home page looks like this:
![Plugin home](./img/accueilPlugin.png)


From this page you can view the current associations between a Caldera ability and a Qradar rule, create an association, launch the Qradar rule non-regression verification process and view the rules that have worked.

## Using the plugin

The aim is to deploy Caldera with the plugin already activated. Once deployed, install the agents on the test targets.

Then define abilities in caldera and create (if you haven't already done so) the rule in QRadar.

Finally, in the Bastiodon plugin, make the associations between a Caldera ability and a QRadar rule. You can then launch rule verification from the Bastiodon interface or via an API call.
The verification report can be accessed from the interface or via an API call.

### Limitations

The plugin is not completely finished.

Registration of associations is not functional, nor is the launch of attacks.
However, rule checking and a report are available, although attacks are launched manually.

Alert verification is fairly primitive, so detection should be refined to avoid false positives, and offences should be cleaned up after verification.

## Files used to create the plugin

The structure of a Caldera plugin follows the MVC model.
The HTML front end is located in `templates/bastiodon.html`.

The `hook.py` file is used to create new HTTP endpoints for the Bastiodon plugin.  

The python APIs associated with each route in the `hook.py` file are defined in the `app/bastiodon_api.py` file. Each API in this file calls a service located in `app/bastiodon_svc.py`.

The `app/bastiodon_gui.py` file provides the plugin's HTML page.  

the `app/qradar/api.py` file is used to make API calls to the Qradar server.

The front-end frameworks used by Caldera (prior to version 5.x) are Alpine.js for javascript and Bulma for CSS.